<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soldier Battle</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        .game-board {
            display: grid;
            gap: 5px;
            margin-bottom: 20px;
        }

        .cell {
            width: 100px;
            height: 100px;
            background-color: #fff;
            border: 2px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            position: relative;
        }

        .soldier {
            font-size: 2em;
        }

        .soldier-red {
            color: red;
        }

        .soldier-blue {
            color: blue;
        }

        .soldier-red-strong {
            color: red;
            font-size: 2.5em;
        }

        .soldier-blue-strong {
            color: blue;
            font-size: 2.5em;
        }

        .soldier-red-fast {
            color: red;
            font-size: 1.5em;
        }

        .soldier-blue-fast {
            color: blue;
            font-size: 1.5em;
        }

        .status {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .controls button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }

        .upgrade {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .upgrade button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }

        .highlight {
            border: 2px solid yellow;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="setBoardSize(3)">3x3 Board</button>
        <button onclick="setBoardSize(4)">4x4 Board</button>
        <button onclick="setBoardSize(5)">5x5 Board</button>
    </div>
    <div class="game-board" id="gameBoard"></div>
    <div class="status" id="status">Player Red's turn</div>
    <div class="controls">
        <button onclick="restartGame()">Restart Game</button>
    </div>
    <div class="upgrade">
        <button onclick="upgradeSoldier('strong')">Upgrade to Strong Soldier</button>
        <button onclick="upgradeSoldier('fast')">Upgrade to Fast Soldier</button>
    </div>
    <script>
        const gameBoard = document.getElementById('gameBoard');
        const statusDisplay = document.getElementById('status');
        let currentPlayer = 'red';
        let gameState = [];
        let selectedCell = null;
        let soldierType = 'normal';
        let boardSize = 3;
        let winCondition = 3;

        function setBoardSize(size) {
            boardSize = size;
            if (size === 5) {
                winCondition = 4;
            } else {
                winCondition = 3;
            }
            restartGame();
        }

        function createBoard() {
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${boardSize}, 100px)`;
            gameBoard.style.gridTemplateRows = `repeat(${boardSize}, 100px)`;
            gameState = Array(boardSize * boardSize).fill("");
            for (let i = 0; i < boardSize * boardSize; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.setAttribute('data-index', i);
                cell.addEventListener('click', handleCellClick);
                gameBoard.appendChild(cell);
            }
        }

        function handleCellClick(event) {
            const clickedCell = event.target;
            const clickedCellIndex = parseInt(clickedCell.getAttribute('data-index'));

            if (gameState[clickedCellIndex] === "" && selectedCell === null) {
                gameState[clickedCellIndex] = currentPlayer;
                clickedCell.innerHTML = `<div class="soldier soldier-${currentPlayer}-${soldierType}">${currentPlayer === 'red' ? 'üßë‚Äçü¶∞' : 'üßë‚Äçü¶±'}</div>`;
                handleResultValidation();
            } else if (gameState[clickedCellIndex] === currentPlayer) {
                selectedCell = clickedCellIndex;
                highlightCell(clickedCell, true);
            } else if (selectedCell !== null && gameState[clickedCellIndex] === "") {
                gameState[selectedCell] = "";
                cells[selectedCell].innerHTML = "";
                highlightCell(cells[selectedCell], false);

                gameState[clickedCellIndex] = currentPlayer;
                clickedCell.innerHTML = `<div class="soldier soldier-${currentPlayer}-${soldierType}">${currentPlayer === 'red' ? 'üßë‚Äçü¶∞' : 'üßë‚Äçü¶±'}</div>`;
                selectedCell = null;
                handleResultValidation();
            } else if (selectedCell !== null && gameState[clickedCellIndex] !== currentPlayer) {
                gameState[clickedCellIndex] = currentPlayer;
                clickedCell.innerHTML = `<div class="soldier soldier-${currentPlayer}-${soldierType}">${currentPlayer === 'red' ? 'üßë‚Äçü¶∞' : 'üßë‚Äçü¶±'}</div>`;
                gameState[selectedCell] = "";
                cells[selectedCell].innerHTML = "";
                highlightCell(cells[selectedCell], false);
                selectedCell = null;
                handleResultValidation();
            }
        }

        function highlightCell(cell, highlight) {
            if (highlight) {
                cell.classList.add('highlight');
            } else {
                cell.classList.remove('highlight');
            }
        }

        function handleResultValidation() {
            let roundWon = false;
            for (let i = 0; i < boardSize * boardSize; i++) {
                const winCondition = checkWinCondition(i);
                if (winCondition) {
                    roundWon = true;
                    break;
                }
            }

            if (roundWon) {
                statusDisplay.textContent = 'Player ' + (currentPlayer === 'red' ? 'Red' : 'Blue') + ' has won!';
                isGameActive = false;
                return;
            }

            const roundDraw = gameState.every(cell => cell !== "");
            if (roundDraw) {
                statusDisplay.textContent = 'Game ended in a draw!';
                isGameActive = false;
                return;
            }

            currentPlayer = currentPlayer === "red" ? "blue" : "red";
            statusDisplay.textContent = 'Player ' + (currentPlayer === 'red' ? 'Red' : 'Blue') + '\'s turn';
        }

        function checkWinCondition(index) {
            const row = Math.floor(index / boardSize);
            const col = index % boardSize;
            let count = 0;

            // Check row
            for (let i = 0; i < boardSize; i++) {
                if (gameState[row * boardSize + i] === currentPlayer) {
                    count++;
                    if (count === winCondition) return true;
                } else {
                    count = 0;
                }
            }

            count = 0;
            // Check column
            for (let i = 0; i < boardSize; i++) {
                if (gameState[i * boardSize + col] === currentPlayer) {
                    count++;
                    if (count === winCondition) return true;
                } else {
                    count = 0;
                }
            }

            count = 0;
            // Check diagonal (top-left to bottom-right)
            let startRow = row - Math.min(row, col);
            let startCol = col - Math.min(row, col);
            for (let i = 0; i < boardSize; i++) {
                if (startRow + i < boardSize && startCol + i < boardSize) {
                    if (gameState[(startRow + i) * boardSize + (startCol + i)] === currentPlayer) {
                        count++;
                        if (count === winCondition) return true;
                    } else {
                        count = 0;
                    }
                }
            }

            count = 0;
            // Check diagonal (top-right to bottom-left)
            startRow = row - Math.min(row, boardSize - 1 - col);
            startCol = col + Math.min(row, boardSize - 1 - col);
            for (let i = 0; i < boardSize; i++) {
                if (startRow + i < boardSize && startCol - i >= 0) {
                    if (gameState[(startRow + i) * boardSize + (startCol - i)] === currentPlayer) {
                        count++;
                        if (count === winCondition) return true;
                    } else {
                        count = 0;
                    }
                }
            }

            return false;
        }

        function restartGame() {
            currentPlayer = 'red';
            gameState = Array(boardSize * boardSize).fill("");
            statusDisplay.textContent = 'Player Red\'s turn';
            cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.innerHTML = '';
                cell.classList.remove('highlight');
            });
            selectedCell = null;
            soldierType = 'normal';
            isGameActive = true;
            createBoard();
        }

        function upgradeSoldier(type) {
            soldierType = type;
            statusDisplay.textContent = 'Player ' + (currentPlayer === 'red' ? 'Red' : 'Blue') + '\'s turn with ' + (type === 'strong' ? 'Strong' : 'Fast') + ' Soldier';
        }

        createBoard();
    </script>
</body>
</html>
